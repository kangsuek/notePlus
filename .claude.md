# notePlus - Claude Code 프로젝트 가이드

## 프로젝트 개요

**제품명**: notePlus
**설명**: 마크다운 메모 + 계산기 macOS 네이티브 앱
**핵심 가치**: macOS 사용자가 마크다운 문법으로 메모를 작성하면서 동시에 수식 계산을 할 수 있는 앱

**타겟 사용자**: 메모와 계산을 동시에 필요로 하는 macOS 사용자 (개발자, 연구자, 학생)

---

## 기술 스택

**플랫폼**: macOS 11.0+

**핵심 기술**:
- Electron + React + TypeScript
- Vite (빌드 도구)
- Jest + React Testing Library (테스트)
- electron-builder (패키징)

**주요 라이브러리**:
- `marked`: 마크다운 파싱
- `mathjs`: 안전한 수식 계산 (eval 금지)
- `electron-store`: 로컬 스토리지 관리
- `styled-components`: UI 스타일링

---

## 개발 원칙

### 1. TDD (Test-Driven Development)
- 모든 기능 개발 시 **테스트부터 작성**
- 개발 순서: **테스트 실패 → 구현 → 테스트 통과 → 리팩토링**
- 목표 테스트 커버리지: 70% 이상
- 유닛 테스트 + 통합 테스트 필수
- 모든 테스트 통과 후에만 배포

### 2. 코드 품질
- **단일 책임 원칙**: 함수는 하나의 역할만
- **읽기 쉬운 코드**: 의도를 명확히 표현, 최소한의 주석
- **TypeScript 엄격 모드**: 타입 안정성 최우선
- **함수형 프로그래밍**: 가능한 순수 함수, 부작용 최소화
- Prettier + ESLint 코드 스타일 유지

### 3. 보안 원칙
- Electron 보안 모델 준수:
  - `nodeIntegration: false`
  - `contextIsolation: true`
- CSP (Content Security Policy) 적용
- mathjs를 통한 안전한 수식 계산 (eval 절대 금지)
- 사용자 입력 검증 필수

---

## 핵심 기능

1. **마크다운 편집**: 실시간 프리뷰, 모든 마크다운 문법 지원
2. **수식 계산**: `=` 입력 시 즉시 계산 결과 표시 (mathjs 사용)
3. **양방향 스크롤 동기화**: Editor ↔ Preview 간 스크롤 동기화 (무한 루프 방지)
4. **파일 관리**: 로컬 파일 저장/열기, 최근 문서 관리, 드래그 앤 드롭 지원
5. **macOS 네이티브**: Dark Mode, 키보드 단축키, 메뉴바 시스템
6. **다중 파일 포맷**: .md, .txt, .pdf 지원
7. **에러 처리**: React 에러 바운더리 및 사용자 친화적 에러 화면
8. **성능 최적화**: 메모리 관리, 성능 모니터링, 자동 정리 시스템

---

## UI/UX 설계

### 디자인 원칙
- macOS Human Interface Guidelines 준수
- Dark Mode / Light Mode 지원 필수
- 반응형 레이아웃

### 화면 구성
- **Sidebar**: 최근 문서 목록 (접기/펼치기 가능)
- **Editor**: 마크다운 편집기 (라인 넘버 표시)
- **Preview**: 실시간 HTML 프리뷰
- **StatusBar**: 커서 위치, 파일 인코딩, 저장 상태
- **MenuBar**: File, Edit, View, Window, Help

### 주요 인터랙션
- 실시간 마크다운 프리뷰
- `=` 입력 시 즉시 계산 결과 표시
- Editor ↔ Preview 양방향 스크롤 동기화
- 드래그 앤 드롭 파일 열기
- ResizablePane으로 영역 크기 조절

---

## 파일 구조

```
src/
├── main/           # Electron 메인 프로세스
├── renderer/       # React 렌더러 프로세스
├── shared/         # 공유 타입 및 유틸리티
├── components/     # React 컴포넌트
├── hooks/          # 커스텀 훅
├── utils/          # 유틸리티 함수
└── __tests__/      # 테스트 파일
```

---

## 네이밍 컨벤션

- **컴포넌트**: PascalCase (예: `MarkdownEditor.tsx`)
- **훅**: camelCase with 'use' prefix (예: `useMarkdown.ts`)
- **유틸리티**: camelCase (예: `calculateExpression.ts`)
- **테스트**: `*.test.ts` 또는 `*.spec.ts`
- **상수**: UPPER_SNAKE_CASE (예: `MAX_RECENT_FILES`)

---

## 코드 작성 가이드

### DO (반드시 할 것)
- 기능 구현 전 테스트 먼저 작성
- TypeScript 타입 명시적으로 정의
- 에러 핸들링 및 엣지 케이스 처리
- 함수는 작고 명확한 하나의 역할만
- 컴포넌트는 재사용 가능하게 설계
- IPC 통신 시 타입 안정성 보장
- 사용자 입력 검증 및 sanitization

### DON'T (절대 하지 말 것)
- eval() 또는 Function() 생성자 사용
- 테스트 없이 코드 배포
- nodeIntegration 활성화
- 하드코딩된 값 (상수로 분리)
- 100줄 이상의 긴 함수
- any 타입 남용
- console.log 남겨두기 (개발용은 제거)

---

## 스크롤 동기화 상세 요구사항

**목표**: Editor와 Preview 간 부드럽고 정확한 스크롤 동기화

**핵심 요구사항**:

1. **양방향 동기화**
   - Editor 스크롤 → Preview 자동 스크롤
   - Preview 스크롤 → Editor 자동 스크롤
   - 줄번호 영역도 Editor와 함께 스크롤

2. **스크롤 비율 기반 동기화**
   ```
   스크롤 비율 = 현재 스크롤 위치 / 최대 스크롤 가능 높이
   목표 스크롤 위치 = 스크롤 비율 × 목표 영역의 최대 스크롤 높이
   ```

3. **경계 케이스 처리**
   - 맨 위: `scrollTop <= 1px` → 상대방도 정확히 `scrollTop = 0`
   - 맨 아래: `scrollTop >= maxScroll - 1px` → 상대방도 정확히 맨 아래
   - 중간: 스크롤 비율 계산 (0~1 범위로 clamp)

4. **무한 루프 방지**
   - Editor 스크롤 시 Preview 핸들러 일시 차단 (플래그)
   - Preview 스크롤 시 Editor 핸들러 일시 차단 (플래그)
   - 100ms 후 플래그 자동 리셋

5. **성능 최적화**
   - `requestAnimationFrame` 기반 throttle 사용
   - 불필요한 리렌더링 방지

---

## 성능 목표

- 앱 시작 시간: 3초 이내
- 메모리 사용량: 100MB 이하
- 테스트 커버리지: 70% 이상
- 전체 테스트 통과: 모든 테스트 케이스 통과

---

## 개발 로드맵

### Phase 1 (MVP)
- 마크다운 편집 + 실시간 프리뷰
- 수식 계산 기능
- 기본 파일 관리
- 드래그 앤 드롭 파일 열기
- 최근 문서 목록 관리

### Phase 2 (macOS 네이티브)
- 키보드 단축키
- 스크롤 동기화
- 파일 시스템 연동
- 메뉴바 시스템
- 테마 토글 (Dark/Light Mode)
- 에러 바운더리
- 성능 모니터링 및 메모리 관리

### Phase 3 (고급 기능)
- 검색 기능
- 내보내기 (PDF, HTML)
- 구문 강조

### Phase 4 (확장)
- 클라우드 동기화
- 플러그인 시스템

---

## 중요한 구현 세부사항

### 자동 줄바꿈 시 줄번호 동작
1. 논리적 줄 (Enter 키로 생성된 실제 줄): 줄번호 표시
2. 자동 줄바꿈된 시각적 줄: 줄번호 없이 빈칸
   ```
   1  첫 번째 줄입니다
   2  이것은 매우 긴 텍스트로 에디터 폭을 초과하여 자동으로 줄바꿈되는 내용입니다
      ← 이 부분은 자동 줄바꿈된 시각적 줄이므로 줄번호 없이 빈칸
   3  세 번째 실제 줄입니다
   ```

### 파일명 편집
- Sidebar 상단 파일명 클릭 시 inline 편집 가능
- Enter/Escape 키 지원
- 수정 상태 시 파일명 뒤 `*` 표시

### StatusBar 동작
- 커서 위치 실시간 추적 (줄/칸 즉시 반영)
- 수정 상태 "수정됨" 3초간 표시 후 자동 숨김

### 키보드 단축키
- macOS 표준 단축키 지원: Cmd+N, Cmd+O, Cmd+S, Cmd+Shift+S, Cmd+Y, Cmd+H 등

---

## 참고 문서

- [docs/01.prd.md](docs/01.prd.md): 상세한 제품 요구사항 문서
- [docs/02.progress-status.md](docs/02.progress-status.md): 개발 진행 상황 및 계획
- [.cursorrules](.cursorrules): Cursor AI 개발 규칙
